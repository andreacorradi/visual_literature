<!DOCTYPE html>

<html lang="en">
	<head>
		<!-- Meta -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<meta name="description" content="">
		<meta name="author" content="">
		
		<title>Visual literature</title>
		
		<!-- Bootstrap Core CSS -->
		<link href="assets/css/bootstrap.min.css" rel="stylesheet">
		
		<!-- Customizable CSS -->
		<link href="assets/css/main.css" rel="stylesheet" data-skrollr-stylesheet>
		<link href="assets/css/color.css" rel="stylesheet" title="Color">
		<link href="assets/css/custom.css" rel="stylesheet">
		<link href="assets/css/owl.carousel.css" rel="stylesheet">
		<link href="assets/css/owl.transitions.css" rel="stylesheet">
		<link href="assets/css/animate.min.css" rel="stylesheet">		
		
		<!-- Fonts -->
		<link href="http://fonts.googleapis.com/css?family=Lato:400,900,300,700" rel="stylesheet">
		<!-- <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic,700italic" rel="stylesheet"> -->
		
		<!-- Icons/Glyphs -->
		<link href="assets/fonts/fontello.css" rel="stylesheet">
		
		<!-- Favicon -->
		<link rel="shortcut icon" href="assets/images/favicon.png">
		
		<!-- HTML5 elements and media queries Support for IE8 : HTML5 shim and Respond.js -->
		<!--[if lt IE 9]>
			<script src="assets/js/html5shiv.js"></script>
			<script src="assets/js/respond.min.js"></script>
		<![endif]-->
	</head>
	
	<body>
		
		<!-- ============================================================= HEADER ============================================================= -->
		
		<header>
			<div class="navbar">

				<div class="navbar-header">
					<div class="container">						
						<!-- ============================================================= LOGO MOBILE ============================================================= -->
						
						<!-- <a class="navbar-brand" href="index.html"><img src="assets/images/logo.svg" class="logo" alt=""></a> -->
						
						<!-- ============================================================= LOGO MOBILE : END ============================================================= -->
						
						<a class="btn responsive-menu pull-right" data-toggle="collapse" data-target=".navbar-collapse"><i class='icon-menu-1'></i></a>						
					</div><!-- /.container -->
				</div><!-- /.navbar-header -->

				<div class="yamm">
					<div class="navbar-collapse collapse">
						<div class="container">
							
							<!-- ============================================================= LOGO ============================================================= -->
							
							<!-- <a class="navbar-brand" href="index.html"><img src="assets/images/logo.svg" class="logo" alt=""></a> -->
							
							<!-- ============================================================= LOGO : END ============================================================= -->
							
							
							<!-- ============================================================= MAIN NAVIGATION ============================================================= -->
							
							<ul class="nav navbar-nav">
								
								<li class="dropdown">
									<a href="#visual-literature">Visual literature</a>
								</li><!-- /.dropdown -->
								
								<li class="dropdown">
									<a href="#explorer">Explorer</a>
								</li><!-- /.dropdown -->
								
								<li class="dropdown">
									<a href="#comparison">Comparison</a>
								</li><!-- /.dropdown -->
								
								<li class="dropdown">
									<a href="#try-yourself">Try yourself</a>
								</li><!-- /.dropdown -->
								
							</ul><!-- /.nav -->

							<!-- <a class="btn responsive-menu" data-toggle="collapse" data-target=".navbar-collapse"><i class='icon-menu-1'></i></a> -->
							
							<!-- ============================================================= MAIN NAVIGATION : END ============================================================= -->
							
						</div><!-- /.container -->
					</div><!-- /.navbar-collapse -->
				</div><!-- /.yamm -->
			</div><!-- /.navbar -->
		</header>
		
		<!-- ============================================================= HEADER : END ============================================================= -->
		
		
		<!-- ============================================================= MAIN ============================================================= -->
		
		<main>
			
			<!-- ============================================================= SECTION – VISUAL LITERATURE ============================================================= -->
			
			<section id="visual-literature" class="light-bg">
				<div class="container inner-top-sm inner-bottom-sm">

					<div class="row">
						<div class="col-md-8 col-sm-9 center-block text-center">
							<header>
								<h1><a name="visual-literature">Visual literature</a></h1>
								<div id="owl-testimonials" class="owl-carousel owl-outer-nav owl-ui-md">							
								<div class="item">
									<blockquote>
										<p>I would define, in brief, the poetry of words<br>as the rhythmical creation of beauty.</p>
										<footer>
											<cite>Edgar Allan Poe, The Poetic Principle</cite>
										</footer>
									</blockquote>
								</div><!-- /.item -->
							</div><!-- /.owl-carousel -->
								<p class="inner-top-sm">The project tries to visualize the writing style of an author through a diagram generated by the rhythm of the text. While the text is read from left to right, the diagram grows from bottom to top: a complex and articulated writing flow will produce a high and wide shape, while a blunt and concise prose will result in a smaller and sharper diagram.</p>
							</header>
						</div><!-- /.col -->
					</div><!-- /.row -->
				
					<div class="row inner-top-sm">
						<div class="col-md-4 inner-bottom-xs">
							<h2>Sentences</h2>
							<p class="text-small">Each sentence is represented by a line. The longer the sentence, the longer the line. If there are no <i>comas</i> (, ; :) the line will be vertical; <i>comas</i> produce a drift from the central axes. Red and green represent respectively sentences ending with question and exclamation marks.</p>
						</div><!-- /.col -->
					
						<div class="col-md-4 inner-bottom-xs">
							<h2>Paragraphs</h2>
							<p class="text-small">Each paragraph includes one to many sentences; it sprouts from a single point at the very bottom and grow up. The whole text is represented by the overlay of all the paragraphs.</p>
						</div><!-- /.col -->
					
						<div class="col-md-4 inner-bottom-xs">
							<h2>Characters</h2>
							<p class="text-small">Each author's text fragment is composed by 400.000 characters. In this way there are enough data to build a meaningful diagram: in many cases a significant part of the whole book is represented.</p>
						</div><!-- /.col -->					
					</div><!-- /.row -->
				
				</div><!-- /.container -->
			</section>
			
			<!-- ============================================================= SECTION – VISUAL LITERATURE : END ============================================================= -->
			
			
			<!-- ============================================================= SECTION – EXPLORER ============================================================= -->
			
			
			<section id="explorer">

				<div id="container-explorer" class="container inner-top-sm inner-bottom-sm">
					
					<div class="row">
						<div id="header-explorer" class="col-md-8 col-sm-9 center-block text-center">
							<header>
								<h1><a name="explorer">Explore</a></h1>
								<p>Let's pick an author up from the window menu and visualize the diagram related to his/her masterpiece. Each branch represent a sentence, and if you mouse over it you'll see its first hundred words.</p>
							</header>
						</div><!-- /.col -->
					</div><!-- /.row -->

					<div class="row inner-top-xs">
						<div class="col-md-8 col-sm-9 center-block text-center">
							<select>
						        <option value="austen" selected>Jane Austen</option>
						        <option value="cervantes">Miguel De Cervantes</option>
						        <option value="dickens">Charles Dickens</option>
						        <option value="dostoevskij">Fëdor Dostoevskij</option>
						        <option value="dumas">Alexandre Dumas</option>
						        <option value="fitzgerald">Francis Scott Fitzgerald</option>
						        <option value="hugo">Victor Hugo</option>
						        <option value="joyce">James Joyce</option>
						        <option value="london">Jack London</option>
						        <option value="manzoni">Alessandro Manzoni</option>
						        <option value="melville">Herman Melville</option>						        
						        <option value="proust">Marcel Proust</option>
						        <option value="swift">Jonathan Swift</option>
						        <option value="tolstoj">Lev Tolstoj</option>
						        <option value="wilde">Oscar Wilde</option>
						        <option value="woolf">Virginia Woolf</option>	
						        <option value="prova">prova</option>	        
						    </select>
						</div><!-- /.col -->
					</div><!-- /.row -->

					<div class="row inner-top-xs">
						<div id="explorer-diagram" class="col-lg-12 col-md-8 col-xs-12">
							<div id="tooltip" class="hidden">
						        <p><strong><span id="title-tooltip"></span></strong></p>
						        <p><span id="value"></span></p>
						    </div>					    
						    <div id="tooltip2">
						        <p><span id="value2"></span></p>
						    </div>		
					    </div><!-- /.col -->
					</div><!-- /.row -->
					
				</div><!-- /.container -->
			</section>
			
			<!-- ============================================================= SECTION – EXPLORER : END ============================================================= -->
			
			
			<!-- ============================================================= SECTION – COMPARISON ============================================================= -->
			
			<section id="comparison" class="light-bg">

				<div class="container inner-top-sm inner-bottom-xs">
					<div class="row">
						<div class="col-md-8 col-sm-9 center-block text-center">
							<header>
								<h1><a name="comparison">Compare</a></h1>
								<p>The diagrams of the 16 authors available in the previous section are shown together, in order to enable a quick comparison and to better highlight differencies and similarities.</p>
							</header>
						</div><!-- /.col -->
					</div><!-- /.row -->
				</div><!-- /.container -->

				<div class="portfolio inner-bottom-sm">
					
					<ul class="items fullscreen">
						
						<li class="item thumb">							
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Jane Austen</h4>
											<p>Pride and prejudice</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/austen.png" alt="">
								</figure>							
						</li><!-- /.item -->
						
						<li class="item thumb">							
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Miguel De Cervantes</h4>
											<p>Don Quixote</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/cervantes.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Charles Dickens</h4>
											<p>David Copperfield</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/dickens.png" alt="">
								</figure>
						</li><!-- /.item -->

						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Fëdor Dostoevskij</h4>
											<p>The idiot</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/dostoevskij.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Alexandre Dumas</h4>
											<p>Les Trois Mousquetaires</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/dumas.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Francis Scott Fitzgerald</h4>
											<p>The Beautiful and Damned</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/fitzgerald.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Victor Hugo</h4>
											<p>Notre dame de Paris</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/hugo.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>James Joyce</h4>
											<p>Ulysses</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/joyce.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Jack London</h4>
											<p>White fang</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/london.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Alessandro Manzoni</h4>
											<p>I promessi sposi</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/manzoni.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Hermann Melville</h4>
											<p>The old and the sea</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/melville.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">							
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Marcel Proust</h4>
											<p>À la recherche du temps perdu</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/proust.png" alt="">
								</figure>							
						</li><!-- /.item -->
						
						<li class="item thumb">							
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Jonathan Swift</h4>
											<p>Gulliver's travels</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/swift.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Lev Tolstoj</h4>
											<p>Anna Karenina</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/tolstoj.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Oscar Wilde</h4>
											<p>The portrait of Dorian Gray</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/wilde.png" alt="">
								</figure>
						</li><!-- /.item -->
						
						<li class="item thumb">
								<figure>
									<figcaption class="text-overlay">
										<div class="info">
											<h4>Virginia Woolf</h4>
											<p>Night and day</p>
										</div><!-- /.info -->
									</figcaption>
									<img src="assets/images/diagrams/woolf.png" alt="">
								</figure>
						</li><!-- /.item -->
						
					</ul><!-- /.items -->
					
				</div><!-- /.portfolio -->

			</section>
			
			<!-- ============================================================= SECTION – COMPARISON : END ============================================================= -->


			<!-- ============================================================= SECTION – TRY YOURSELF ============================================================= -->
		
			<section id="try-yourself">
				<div class="container inner-top-sm inner-bottom-xs">
					
					<div class="row">
						<div class="col-md-8 col-sm-9 center-block text-center">
							<header>
								<h1><a name="try-yourself">Try yourself</a></h1>
								<p>Let's write or paste some text in the following box and press the <i>generate diagram</i> button! You'll have your text fragment analyzed by the algorythm and displayed. Please note that in this case the height of the diagram - as well as the tilt angle of the branches - depends on the length of the text fragment.</p>
							</header>
						</div><!-- /.col -->
					</div><!-- /.row -->

					<div class="row inner-top-xs inner-bottom-xs">
						<div class="col-md-8 col-sm-9 center-block text-center">
							<textarea id="textInput" type="text"></textarea>
  							<input class="inputButton btn btn-navy" type="button" value="generate diagram" onClick="drawText()">
  						</div><!-- /.col -->
					</div><!-- /.row -->

					<div class="row">
						<div id="how-it-works-diagram" class="col-lg-12 col-md-8 col-xs-12">
							<div id="tooltip3" class="hidden">
						        <p><strong><span id="title-tooltip3"></span></strong></p>
						        <p><span id="value3"></span></p>
						    </div>					    
						    <div id="tooltip4">
						        <p><span id="value4"></span></p>
						    </div>		
					    </div><!-- /.col -->
					</div><!-- /.row -->
					
				</div><!-- /.container -->
			</section>
			
			<!-- ============================================================= SECTION – HOW IT WORKS : END ============================================================= -->
			
		</main>
		
		<!-- ============================================================= MAIN : END ============================================================= -->
		
		
		<!-- ============================================================= FOOTER ============================================================= -->
		
		<footer class="dark-bg">
			<div class="container inner">
				<div class="row">
					
					<div class="col-md-3 col-sm-6 inner">
						<h4>Get In Touch</h4>
						<p>If you have any question or comment about the project, I'll be glad to answer.</p>
						<ul class="contacts">
							<li><i class="icon-location contact"></i> via Leoncavallo 37/A, Milano</li>
							<li><i class="icon-network contact"></i> <a href="http://www.andreacorradi.com/" target="_blank">www.andreacorradi.com</a></li>
							<li><i class="icon-mail-1 contact"></i> hello@andreacorradi.com</li>
						</ul><!-- /.contacts -->
					</div><!-- /.col -->
					
					<div class="col-md-3 col-sm-6 inner">
						
					</div><!-- /.col -->
					
					
					<div class="col-md-3 col-sm-6 inner">
						<h4>The project</h4>
						<p>Inspired by the works of Stefanie Posavec, Boris Müller et others I tried to work out my own visualization. I first developed a Processing sketch using letter textures; few months later I decided to make this interactive version using lines (much lighter and suitable for small size visualization). Each text fragment is stored in a .txt file; a custom Javascript function transforms it in a data structure that D3.js can use to generate paths.</p>
					</div><!-- /.col -->
					
					<div class="col-md-3 col-sm-6 inner">
						<h4>Sources</h4>
						<p>The text fragments used in this project have been downloaded by the following websites:</p>
						<ul class="contacts">
							<li><a href="http://www.gutenberg.org/" target="_blank">www.projectgutemberg.com</a></li>
							<li><a href="http://www.classicitaliani.it/" target="_blank">www.classicitaliani.it</a></li>
						</ul><!-- /.contacts -->
					</div><!-- /.col -->
					
				</div><!-- /.row --> 
			</div><!-- .container -->
		  
			<div class="footer-bottom">
				<div class="container inner">
					<p class="pull-left">© 2015 Andrea Corradi.</p>
				</div><!-- .container -->
			</div><!-- .footer-bottom -->
		</footer>
		
		<!-- ============================================================= FOOTER : END ============================================================= -->
		
		<!-- JavaScripts placed at the end of the document so the pages load faster -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.easing.1.3.min.js"></script>
		<script src="assets/js/jquery.form.js"></script>
		<script src="assets/js/jquery.validate.min.js"></script>
		<script src="assets/js/bootstrap.min.js"></script>
		<script src="assets/js/bootstrap-hover-dropdown.min.js"></script>
		<script src="assets/js/skrollr.min.js"></script>
		<script src="assets/js/skrollr.stylesheets.min.js"></script>
		<script src="assets/js/waypoints.min.js"></script>
		<script src="assets/js/waypoints-sticky.min.js"></script>
		<script src="assets/js/owl.carousel.min.js"></script>
		<script src="assets/js/jquery.isotope.min.js"></script>
		<script src="assets/js/jquery.easytabs.min.js"></script>
		<script src="assets/js/viewport-units-buggyfill.js"></script>
		<script src="assets/js/scripts.js"></script>

		<!-- Section explorer -->
		<!-- <script src="http://d3js.org/d3.v3.js"></script> -->
		<script src="d3/d3.v3.js"></script>
		<!-- <script src="http://code.jquery.com/jquery-latest.min.js"></script> -->
		<!-- <script src="assets/js/jquery.localscroll.js" type="text/javascript"></script> -->
		<!-- <script src="assets/js/jquery.scrollTo.js" type="text/javascript"></script> -->

		<script type="text/javascript">
			//$(document).ready(function() {
			   //$('#header-explorer').localScroll({duration:800});
			//});
		</script>

		<script>

		var margin = {top: 30, right: 30, bottom: 30, left: 30},
		width = $("#container-explorer").width() - margin.left - margin.right;
		height = 660 - margin.top - margin.bottom;

		var svg = d3.select("#explorer-diagram").append("svg")
		        .attr("width", width + margin.left + margin.right);
		        //.attr("height", height + margin.top + margin.bottom);

		var gsvg = svg
		      .append("g");

		function update(nuovolibro){

		    var testo = nuovolibro;

		    d3.text(testo, function(d){

		        function points(ascissa, ordinata, typedot, testo, numero) {
		            this.ascissa = ascissa;
		            this.ordinata = ordinata;
		            this.typedot = typedot; //tipo di punto
		            this.testo = testo;
		            this.numero = numero;
		        }

		        function sentence(order, typedot, testo) {
		            this.order = order; //order = 0: prima frase del paragrafo, order = 1: seconda frase del paragrafo, etc.
		            this.typedot = typedot; //tipo di punto
		            this.testo = testo;
		        }

		        //riconosce tipologia di punto
		        var checkTypeDot = function(dot) {
		          switch(dot) {
		              case ".":
		                  return 1;
		                  break;
		              case "?":
		                  return 2;
		                  break;
		              case "!":
		                  return 3;
		                  break;
		              default:
		                  return 1;
		          }
		        }

		        //ogni elemento dell'array è una frase, ciascuna con il proprio ordinale riferito al paragrafo di provenienza
		        var orderedSentences = new Array();
		        //ogni elemento è una collezione di punti riferiti ad una frase, è il dataset preparato per la visualizzazione
		        var sentencePoints = new Array();

		        var numCharacters = d.length;
		        var cutCharacters = 400000;
		        
		        if (numCharacters > cutCharacters) {
		          var reducedText = d.slice(0, 400000);
		          numCharacters = cutCharacters;
		        } else {
		          var reducedText = d;
		        }

		        //divido il testo di partenza in paragrafi
		        var paragraphs = reducedText.split("\n");

		        //elimino i paragrafi vuoti
		        for (var i=0; i < paragraphs.length; i++) {
		        	if (paragraphs[i] === "") paragraphs.splice(i, 1);
		        }

		        var numParagraphs = paragraphs.length;

		        var yMaxTotalOffset = 0; //è il valore massimo dell'ordinata raggiunta dal paragrafo più lungo

		        //rapporto fra numero di virgole e lunghezza frase
		        var comaSentenceRatioTemp = new Array();
		        var comaSentenceRatioTot = 0;

		        //numero di paragrafi con una sola frase, inizializzo a numParagraphs e poi vado a scalare
		        var singleSentencePar = numParagraphs;
		        //numero di frasi senza virgole
		        var noComaSentence = 0;

		        //divido ogni paragrafo in frasi, raggruppate per paragrafo di provenienza (order = 0: prima frase del paragrafo, order = 1: seconda frase del paragrafo, etc.)
		        for (var i=0; i < paragraphs.length; i++) {

		          var regDot = new RegExp("[.!?]+", "g");

		          //aggiungo un carattere speciale # dopo ogni punto (. o ! o ?) in modo che i risultati della funzione split comprendano i punti stessi
		          var augmentedParagraph = paragraphs[i].replace(/[.!?]/g, function addAuxChar(x){return x + "#";});
		          var sentences = augmentedParagraph.split("#");
		          //elimino l'ultimo elemento dell'array (stringa vuota)
		          sentences.pop();

		          for (var j=0; j < sentences.length; j++){
		            var typeDot = sentences[j].charAt(sentences[j].length - 1);
		            orderedSentences.push(new sentence(j, checkTypeDot(typeDot), sentences[j]));
		            if (j === 1) singleSentencePar--; //scalo da numParagraphs i paragrafi con più di una frase
		          }

		        }

		        var numFrasi = orderedSentences.length;
		        //rapporto fra numero frasi e numero paragrafi
		        var sentenceParagraphRatio = Math.round((numParagraphs / numFrasi * 100))/100;

		        var ySentenceOffset = 0; //offset cumulato delle frasi in un paragrafo
		        var yBraniOffset; //offset dovuto ad una frase specifica (somma dei caratteri dei brani)
		        var sideToggle = 1;

		        //ripetuto per ogni frase
		        for (var i=0; i < orderedSentences.length; i++) {

		            var regComas = new RegExp("[,;:]+", "g");

		            // numero di virgole nella frase
		            var numComaSentence = orderedSentences[i].testo.match(regComas);
		            if(numComaSentence === null) {
		              numComaSentence = 0;
		              noComaSentence++;
		            } else {
		              numComaSentence = numComaSentence.length;
		            }

		            //collezione di punti riferiti ad una frase 
		            sentencePoints[i] = new Array();

		            // se la frase è l'inizio di un nuovo paragrafo l'ordinata del punto di partenza del path sarà la radice
		            if (orderedSentences[i].order === 0) {
		              ySentenceOffset = 0;
		            } else {
		              ySentenceOffset += yBraniOffset; //altrimenti sarà = radice + cumulato degli offset delle frasi + numero di caratteri dell'ultima frase
		            }

		            var xOffsetCounter = 0;
		            var xOffsetScale = 10;
		            yBraniOffset = 0;

		            //questo pezzo di codice dà l'asimmetria: tutte le prime frasi di ogni paragrafo vanno sul lato destro
		            if (orderedSentences[i].order != 0) { //ogni paragrafo parte dallo stesso lato
		            	if(sideToggle === 1) {
		            		sideToggle = -1;
		            	} else sideToggle = 1; //la frasi si alternano di lato
		        	} else sideToggle = 1;

		        	//questo pezzo di codice dà simmetria (alternativo al precedente)
		        	/*if(sideToggle === 1) {
		            	sideToggle = -1;
		            } else sideToggle = 1;*/

		            //rapporto fra numero di virgole e numero di caratteri nella i-esima frase
		            if (numComaSentence == 0) {
		              comaSentenceRatioTemp[i] = 0;
		            } else comaSentenceRatioTemp[i] = Math.round(orderedSentences[i].testo.length / numComaSentence);


		            //divido la frase in brani (sequenze di caratteri tra virgola e virgola)
		            for (var j=0; j < numComaSentence + 2; j++) {

		                var brani = orderedSentences[i].testo.split(regComas);

		                var yOffset; // contatore avanzamento caratteri del brano
		                if (j === 0) { //il primo punto della frase ha un avanzamento di caratteri = 0
		                  yOffset = 0;
		                } else {
		                  yOffset += brani[j-1].length; //gli altri punti avanzano del numero di caratteri del brano precedente
		                }

		                //moltiplicatore offset asse x (j<2 perché i primi due punti hanno sempre offset = 0)
		                if (j < 2) {
		                  xOffsetCounter = 0; 
		                } else {
		                  xOffsetCounter++;
		                }

		                //il testo della frase viene memorizzato solo nel primo elemento di classe points
		                var textSentence;
		                if (j === 0) {
		                  textSentence = orderedSentences[i].testo;
		                } else {
		                  textSentence = "";
		                }

		                var yTotalOffset = ySentenceOffset + yOffset; //ordinata del brano corrente + somma delle ordinate delle frasi precedenti
		                if (yTotalOffset > yMaxTotalOffset) yMaxTotalOffset = yTotalOffset;

		                //aggiungo un punto alla rappresentazione della frase
		                sentencePoints[i].push(new points(width/2 + margin.left + sideToggle*xOffsetScale*xOffsetCounter, yTotalOffset, orderedSentences[i].typedot, textSentence, i+1));

		                if (j < numComaSentence + 1) {
		                  //memorizzo l'avanzamento di caratteri raggiunto sull'asse y, per sommarlo alla prossima frase del paragrafo
		                  yBraniOffset = yBraniOffset + brani[j].length;
		                }
		            }

		        }

		        //calcolo della media del rapporto lunghezza frasi / numero di virgole
		        var comaSentenceTot = 0;
		        for(i=0; i < comaSentenceRatioTemp.length; i++) {
		          comaSentenceTot += comaSentenceRatioTemp[i];
		        }
		        comaSentenceRatioTot = Math.round(comaSentenceTot / numFrasi);



		        /*   VISUALIZZAZIONE   */

		        var max_height = 10000; //è un valore un po' più elevato di sentencePoints[i][j].ordinata dell'autore con ordinata massima
		        						//è la massima altezza della finestra di lavoro

		        var x = d3.scale.linear()
		            .domain([0, width])
		            .range([0, width]);

		        var y = d3.scale.linear()
		            .domain([0, max_height])
		            .range([height, 0]);

		        var heightsvg = yMaxTotalOffset/(max_height/height) + margin.top + margin.bottom;

		        svg
		        	.attr("height", heightsvg)
		        	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		        var line = d3.svg.line()
		            .interpolate("basis")
		            .x(function(d) { return x(d.ascissa); })
		            .y(function(d) { return y(d.ordinata); });

		        // la y scale produce tutti i grafici nel range 0 to max_height; siccome l'altezza della svg varia in base all'altezza dell'albero dell'autore devo spostare 
		        // in alto l'albero della differenza fra height  e heightsvg (scalato del rapporto max_height/height) per farlo rientrare nell'svg (+5 margin bottom)
		        for (index1 = 0; index1 < sentencePoints.length ; index1++) {
		        	for (index2 = 0; index2 < sentencePoints[index1].length ; index2++) {
		        		sentencePoints[index1][index2].ordinata = sentencePoints[index1][index2].ordinata + (5 + height - heightsvg)*(max_height/height);
		        	}
		        }

		        var path = gsvg.selectAll("path") // era svg.selectAll(".line")
		            .data(sentencePoints);

		        //selection: update
		        path
		              .attr("class", function(d) {
		                if(d[0].typedot == 1) return "line"; else if(d[0].typedot == 3) return "lineExcl"; else if(d[0].typedot == 2) return "lineQuest";
		              })
		              .attr("d", line);

		        //selection: insert new elements
		        path
		              .enter().append("path")
		              .attr("class", function(d) {
		                if(d[0].typedot == 1) return "line"; else if(d[0].typedot == 3) return "lineExcl"; else if(d[0].typedot == 2) return "lineQuest";
		              })
		              .attr("d", line);

		        //selection: delete old elements
		        path.exit().remove();

		        // avendo molti path, prendo come lunghezza quella del path più lungo
		        var totalLength = 0;
		        for(i=0; i<path[0].length; i++){
		          var partialLength = path[0][i].getTotalLength();
		          if (partialLength > totalLength) totalLength = partialLength;
		        }

		        // var totalLength = path.node().getTotalLength(); // vale per un singolo path

		        /*d3.select("#tooltip2")
		                .select("#value2")
		                .text("Ordinata max:" + yMaxTotalOffset + ", Num paragrafi: " + numParagraphs + ", Num frasi: " + numFrasi + ", Num caratteri: " + numCharacters + ", Paragraph sentence ratio: " + sentenceParagraphRatio + ", Sentence coma ratio: " + comaSentenceRatioTot + ", Single sentence paragraphs: " + singleSentencePar + ", No coma sentences: " + noComaSentence);*/

		        path
		            .on("mouseover", function(d, i) {

		            	//mostro le prime 100 parole di ogni frase
		            	if (d[0].testo.split(' ').length > 80){
		                	var testoCut = d[0].testo.split(' ').slice(0,80).join(' ') + " [...]";
		            	} else var testoCut = d[0].testo;

		                d3.select("#tooltip")
		                .select("#title-tooltip")
		                .text("Sentence " + d[0].numero + " of " + numFrasi);

		                d3.select("#tooltip")
		                .select("#value")
		                .text(testoCut);

		                d3.select("#tooltip").classed("hidden", false);
		                d3.select("#tooltip").attr("top", heightsvg - d[0].ordinata);

		              })
		            .on("mouseout", function() { //Hide the tooltip
		                d3.select("#tooltip").classed("hidden", true);
		              })

		            .attr("stroke-dasharray", totalLength + " " + totalLength)
		            .attr("stroke-dashoffset", totalLength)
		            .transition()
		              .delay(function(d, i) { return i * 20; })
		              .duration(500)
		              .ease("linear")
		              .attr("stroke-dashoffset", 0);

		    });

		}

		//inizializzo il diagramma con un autore
		update("data/austen_UTF8.txt");

		//aggiorno il diagramma con l'autore selezionato nel menu a tendina
		d3.select("select").on("change", function () {
		    var author = $("select").val();
		    var libro = "data/" + author + "_UTF8.txt";
		    update(libro);
		});














		var userText = "";

		var svg2 = d3.select("#how-it-works-diagram").append("svg")
		        .attr("width", width + margin.left + margin.right)
		        .attr("height", 50);

		var gsvg2 = svg2
		      .append("g");

		function drawText(){

		        function points(ascissa, ordinata, typedot, testo, numero) {
		            this.ascissa = ascissa;
		            this.ordinata = ordinata;
		            this.typedot = typedot; //tipo di punto
		            this.testo = testo;
		            this.numero = numero;
		        }

		        function sentence(order, typedot, testo) {
		            this.order = order; //order = 0: prima frase del paragrafo, order = 1: seconda frase del paragrafo, etc.
		            this.typedot = typedot; //tipo di punto
		            this.testo = testo;
		        }

		        //riconosce tipologia di punto
		        var checkTypeDot = function(dot) {
		          switch(dot) {
		              case ".":
		                  return 1;
		                  break;
		              case "?":
		                  return 2;
		                  break;
		              case "!":
		                  return 3;
		                  break;
		              default:
		                  return 1;
		          }
		        }

		        
		        var nameElement = document.getElementById("textInput");
	        	userText = nameElement.value;

		        //ogni elemento dell'array è una frase, ciascuna con il proprio ordinale riferito al paragrafo di provenienza
		        var orderedSentences = new Array();
		        //ogni elemento è una collezione di punti riferiti ad una frase, è il dataset preparato per la visualizzazione
		        var sentencePoints = new Array();

		        var numCharacters = userText.length;
		        var cutCharacters = 400000;
		        
		        if (numCharacters > cutCharacters) {
		          var reducedText = userText.slice(0, 400000);
		          numCharacters = cutCharacters;
		        } else {
		          var reducedText = userText;
		        }

		        //divido il testo di partenza in paragrafi
		        var paragraphs = reducedText.split("\n");
		        //elimino i paragrafi vuoti
		        for (var i=0; i < paragraphs.length; i++) {
		        	if (paragraphs[i] === "") paragraphs.splice(i, 1);
		        }

		        var numParagraphs = paragraphs.length;

		        var yMaxTotalOffset = 0; //è il valore massimo dell'ordinata raggiunta dal paragrafo più lungo

		        //rapporto fra numero di virgole e lunghezza frase
		        var comaSentenceRatioTemp = new Array();
		        var comaSentenceRatioTot = 0;

		        //numero di paragrafi con una sola frase, inizializzo a numParagraphs e poi vado a scalare
		        var singleSentencePar = numParagraphs;
		        //numero di frasi senza virgole
		        var noComaSentence = 0;

		        //divido ogni paragrafo in frasi, raggruppate per paragrafo di provenienza (order = 0: prima frase del paragrafo, order = 1: seconda frase del paragrafo, etc.)
		        for (var i=0; i < paragraphs.length; i++) {

		          var regDot = new RegExp("[.!?]+", "g");

		          //aggiungo un carattere speciale # dopo ogni punto (. o ! o ?) in modo che i risultati della funzione split comprendano i punti stessi
		          var augmentedParagraph = paragraphs[i].replace(/[.!?]/g, function addAuxChar(x){return x + "#";});
		          var sentences = augmentedParagraph.split("#");
		          //elimino l'ultimo elemento dell'array (stringa vuota)
		          sentences.pop();

		          for (var j=0; j < sentences.length; j++){
		            var typeDot = sentences[j].charAt(sentences[j].length - 1);
		            orderedSentences.push(new sentence(j, checkTypeDot(typeDot), sentences[j]));
		            if (j === 1) singleSentencePar--; //scalo da numParagraphs i paragrafi con più di una frase
		          }

		        }

		        var numFrasi = orderedSentences.length;
		        //rapporto fra numero frasi e numero paragrafi
		        var sentenceParagraphRatio = Math.round((numParagraphs / numFrasi * 100))/100;

		        var ySentenceOffset = 0; //offset cumulato delle frasi in un paragrafo
		        var yBraniOffset; //offset dovuto ad una frase specifica (somma dei caratteri dei brani)
		        var sideToggle = 1;

		        //ripetuto per ogni frase
		        for (var i=0; i < orderedSentences.length; i++) {

		            var regComas = new RegExp("[,;:]+", "g");

		            // numero di virgole nella frase
		            var numComaSentence = orderedSentences[i].testo.match(regComas);
		            if(numComaSentence === null) {
		              numComaSentence = 0;
		              noComaSentence++;
		            } else {
		              numComaSentence = numComaSentence.length;
		            }

		            //collezione di punti riferiti ad una frase 
		            sentencePoints[i] = new Array();

		            // se la frase è l'inizio di un nuovo paragrafo l'ordinata del punto di partenza del path sarà la radice
		            if (orderedSentences[i].order === 0) {
		              ySentenceOffset = 0;
		            } else {
		              ySentenceOffset += yBraniOffset; //altrimenti sarà = radice + cumulato degli offset delle frasi + numero di caratteri dell'ultima frase
		            }

		            var xOffsetCounter = 0;
		            var xOffsetScale = 10;
		            yBraniOffset = 0;

		            //questo pezzo di codice dà l'asimmetria: tutte le prime frasi di ogni paragrafo vanno sul lato destro
		            if (orderedSentences[i].order != 0) { //ogni paragrafo parte dallo stesso lato
		            	if(sideToggle === 1) {
		            		sideToggle = -1;
		            	} else sideToggle = 1; //la frasi si alternano di lato
		        	} else sideToggle = 1;

		        	//questo pezzo di codice dà simmetria (alternativo al precedente)
		        	/*if(sideToggle === 1) {
		            	sideToggle = -1;
		            } else sideToggle = 1;*/

		            //rapporto fra numero di virgole e numero di caratteri nella i-esima frase
		            if (numComaSentence == 0) {
		              comaSentenceRatioTemp[i] = 0;
		            } else comaSentenceRatioTemp[i] = Math.round(orderedSentences[i].testo.length / numComaSentence);


		            //divido la frase in brani (sequenze di caratteri tra virgola e virgola)
		            for (var j=0; j < numComaSentence + 2; j++) {

		                var brani = orderedSentences[i].testo.split(regComas);

		                var yOffset; // contatore avanzamento caratteri del brano
		                if (j === 0) { //il primo punto della frase ha un avanzamento di caratteri = 0
		                  yOffset = 0;
		                } else {
		                  yOffset += brani[j-1].length; //gli altri punti avanzano del numero di caratteri del brano precedente
		                }

		                //moltiplicatore offset asse x (j<2 perché i primi due punti hanno sempre offset = 0)
		                if (j < 2) {
		                  xOffsetCounter = 0; 
		                } else {
		                  xOffsetCounter++;
		                }

		                //il testo della frase viene memorizzato solo nel primo elemento di classe points
		                var textSentence;
		                if (j === 0) {
		                  textSentence = orderedSentences[i].testo;
		                } else {
		                  textSentence = "";
		                }

		                var yTotalOffset = ySentenceOffset + yOffset; //ordinata del brano corrente + somma delle ordinate delle frasi precedenti
		                if (yTotalOffset > yMaxTotalOffset) yMaxTotalOffset = yTotalOffset;

		                //aggiungo un punto alla rappresentazione della frase
		                sentencePoints[i].push(new points(width/2 + margin.left + sideToggle*xOffsetScale*xOffsetCounter, yTotalOffset, orderedSentences[i].typedot, textSentence, i+1));

		                if (j < numComaSentence + 1) {
		                  //memorizzo l'avanzamento di caratteri raggiunto sull'asse y, per sommarlo alla prossima frase del paragrafo
		                  yBraniOffset = yBraniOffset + brani[j].length;
		                }
		            }

		        }

		        //calcolo della media del rapporto lunghezza frasi / numero di virgole
		        var comaSentenceTot = 0;
		        for(i=0; i < comaSentenceRatioTemp.length; i++) {
		          comaSentenceTot += comaSentenceRatioTemp[i];
		        }
		        comaSentenceRatioTot = Math.round(comaSentenceTot / numFrasi);



		        /*   VISUALIZZAZIONE   */

		        var max_height = yMaxTotalOffset;

		        var x = d3.scale.linear()
		            .domain([0, width])
		            .range([0, width]);

		        var y = d3.scale.linear()
		            .domain([0, max_height])
		            .range([height, 0]);

		        var heightsvg = yMaxTotalOffset/(max_height/height) + margin.top + margin.bottom;

		        svg2
		        	.attr("height", heightsvg)
		        	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		        var line = d3.svg.line()
		            .interpolate("basis")
		            .x(function(d) { return x(d.ascissa); })
		            .y(function(d) { return y(d.ordinata); });

		        // la y scale produce tutti i grafici nel range 0 to max_height; siccome l'altezza della svg varia in base all'altezza dell'albero dell'autore devo spostare 
		        // in alto l'albero della differenza fra height  e heightsvg (scalato del rapporto max_height/height) per farlo rientrare nell'svg (+5 margin bottom)
		        for (index1 = 0; index1 < sentencePoints.length ; index1++) {
		        	for (index2 = 0; index2 < sentencePoints[index1].length ; index2++) {
		        		sentencePoints[index1][index2].ordinata = sentencePoints[index1][index2].ordinata + (5 + height - heightsvg)*(max_height/height);
		        	}
		        }

		        var path = gsvg2.selectAll("path") // era svg.selectAll(".line")
		            .data(sentencePoints);

		        //selection: update
		        path
		              .attr("class", function(d) {
		                if(d[0].typedot == 1) return "line"; else if(d[0].typedot == 3) return "lineExcl"; else if(d[0].typedot == 2) return "lineQuest";
		              })
		              .attr("d", line);

		        //selection: insert new elements
		        path
		              .enter().append("path")
		              .attr("class", function(d) {
		                if(d[0].typedot == 1) return "line"; else if(d[0].typedot == 3) return "lineExcl"; else if(d[0].typedot == 2) return "lineQuest";
		              })
		              .attr("d", line);

		        //selection: delete old elements
		        path.exit().remove();

		        // avendo molti path, prendo come lunghezza quella del path più lungo
		        if (path[0].length > 1) {
			        var totalLength = 0;
			        var partialLength = 0;
			        for(i=0; i<path[0].length; i++){
			          partialLength = path[0][i].getTotalLength();
			          if (partialLength > totalLength) totalLength = partialLength;
			        }
		    	} else {
		    		var totalLength = path.node().getTotalLength(); // vale per un singolo path
		    	}

		        /*d3.select("#tooltip4")
		                .select("#value4")
		                .text("Ordinata max:" + yMaxTotalOffset + ", Num paragrafi: " + numParagraphs + ", Num frasi: " + numFrasi + ", Num caratteri: " + numCharacters + ", Paragraph sentence ratio: " + sentenceParagraphRatio + ", Sentence coma ratio: " + comaSentenceRatioTot + ", Single sentence paragraphs: " + singleSentencePar + ", No coma sentences: " + noComaSentence);*/

		        path
		            .on("mouseover", function(d) {

		                //mostro le prime 100 parole di ogni frase
		            	if (d[0].testo.split(' ').length > 80){
		                	var testoCut = d[0].testo.split(' ').slice(0,80).join(' ') + " [...]";
		            	} else var testoCut = d[0].testo;

		            	d3.select("#tooltip3")
		                .select("#title-tooltip3")
		                .text("Sentence " + d[0].numero + " of " + numFrasi);

		                d3.select("#tooltip3")
		                .select("#value3")
		                .text(testoCut);

		                d3.select("#tooltip3").classed("hidden", false);

		              })
		            .on("mouseout", function() { //Hide the tooltip
		                d3.select("#tooltip3").classed("hidden", true);
		              })

		            .attr("stroke-dasharray", totalLength + " " + totalLength)
		            .attr("stroke-dashoffset", totalLength)
		            .transition()
		              .delay(function(d, i) { return i * 200; })
		              .duration(2000)
		              .ease("linear")
		              .attr("stroke-dashoffset", 0);

		}

		</script>

	</body>
</html>